"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[655],{3655:(e,a,t)=>{t.r(a),t.d(a,{default:()=>g});var r=t(5155),s=t(2115),i=t(913),n=t(5239),o=t(5325),l=t(5704);let c=l.env.NEXT_PUBLIC_SUPABASE_URL,d=l.env.NEXT_PUBLIC_SUPABASE_ANON_KEY;c&&d||console.warn("Missing Supabase environment variables - authentication will not work"),c&&!(e=>{try{return new URL(e),!0}catch(e){return!1}})(c)&&console.error("Invalid Supabase URL format:",c);let u=(0,o.UU)(c,d,{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"pkce"},global:{headers:{"X-Client-Info":"local-gems-web"}},db:{schema:"public"},realtime:{params:{eventsPerSecond:10}}});class m{static validateImage(e){return this.ALLOWED_TYPES.includes(e.type)?e.size>this.MAX_FILE_SIZE?{isValid:!1,error:"File size too large. Maximum size is 5MB."}:{isValid:!0}:{isValid:!1,error:"Invalid file type. Only JPEG, PNG, and WebP images are allowed."}}static validateImageArray(e){if(e.length>this.MAX_IMAGES_PER_REVIEW)return{isValid:!1,error:"Too many images. Maximum ".concat(this.MAX_IMAGES_PER_REVIEW," images per review.")};for(let a of e){let e=this.validateImage(a);if(!e.isValid)return e}return{isValid:!0}}static async uploadImage(e,a,t){try{let r=this.validateImage(e);if(!r.isValid)return{url:"",error:r.error};let{error:s}=await u.storage.from(a).upload(t,e,{cacheControl:"3600",upsert:!1});if(s)return console.error("Upload error:",s),{url:"",error:s.message||"Failed to upload image"};let{data:{publicUrl:i}}=u.storage.from(a).getPublicUrl(t);return{url:i}}catch(e){return console.error("Image upload error:",e),{url:"",error:e instanceof Error?e.message:"Unknown error occurred"}}}static async uploadMultipleImages(e,a,t){let r=[],s=[],i=this.validateImageArray(e);if(!i.isValid)return{urls:[],errors:[i.error||"Validation failed"]};for(let i=0;i<e.length;i++){let n=e[i],o=n.name.split(".").pop(),l="".concat(t,"_").concat(i,"_").concat(Date.now(),".").concat(o),c=await this.uploadImage(n,a,l);c.error?s.push("Failed to upload ".concat(n.name,": ").concat(c.error)):r.push(c.url)}return{urls:r,errors:s}}static async deleteImage(e,a){try{let{error:t}=await u.storage.from(e).remove([a]);if(t)return console.error("Delete error:",t),!1;return!0}catch(e){return console.error("Image delete error:",e),!1}}static async compressImage(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1920,t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1080,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.8;return new Promise((s,i)=>{let n=document.createElement("canvas"),o=n.getContext("2d"),l=new Image;l.onload=()=>{let{width:c,height:d}=l;c>d?c>a&&(d=d*a/c,c=a):d>t&&(c=c*t/d,d=t),n.width=c,n.height=d,null==o||o.drawImage(l,0,0,c,d),n.toBlob(a=>{a?s(new File([a],e.name,{type:e.type,lastModified:Date.now()})):i(Error("Failed to compress image"))},e.type,r)},l.onerror=()=>{i(Error("Failed to load image for compression"))},l.src=URL.createObjectURL(e)})}static generateImagePath(e,a,t){let r=Date.now();switch(e){case"review":return"review-images/".concat(a,"_").concat(t||0,"_").concat(r,".webp");case"business":return"business-images/".concat(a,"_").concat(r,".webp");case"avatar":return"avatars/".concat(a,"_").concat(r,".webp");default:return"uploads/".concat(a,"_").concat(r,".webp")}}static async getImageDimensions(e){return new Promise((a,t)=>{let r=new Image;r.onload=()=>{a({width:r.naturalWidth,height:r.naturalHeight})},r.onerror=()=>{t(Error("Failed to load image"))},r.src=URL.createObjectURL(e)})}}function g(e){let{onImagesChange:a,maxImages:t=5,disabled:o=!1}=e,[l,c]=(0,s.useState)([]),[d,u]=(0,s.useState)([]),[g,h]=(0,s.useState)(!1),[p,f]=(0,s.useState)(null),x=(0,s.useRef)(null),b=e=>URL.createObjectURL(e),v=(0,s.useCallback)(e=>{let r=Array.from(e),s=m.validateImageArray([...l,...r]);if(!s.isValid)return void f(s.error||"Invalid files");let i=t-l.length,n=r.slice(0,i);n.length<r.length?f("Only ".concat(i," more images can be added")):f(null);let o=n.map(b),g=[...l,...n],h=[...d,...o];c(g),u(h),a(g)},[l,d,t,a]),y=(0,s.useCallback)(e=>{URL.revokeObjectURL(d[e]);let t=l.filter((a,t)=>t!==e),r=d.filter((a,t)=>t!==e);c(t),u(r),a(t),f(null)},[l,d,a]),w=(0,s.useCallback)(e=>{e.preventDefault(),e.stopPropagation(),"dragenter"===e.type||"dragover"===e.type?h(!0):"dragleave"===e.type&&h(!1)},[]),j=(0,s.useCallback)(e=>{e.preventDefault(),e.stopPropagation(),h(!1),!o&&e.dataTransfer.files&&e.dataTransfer.files[0]&&v(e.dataTransfer.files)},[o,v]),E=(0,s.useCallback)(e=>{e.target.files&&e.target.files[0]&&v(e.target.files)},[v]),I=(0,s.useCallback)(()=>{!o&&x.current&&x.current.click()},[o]);return s.useEffect(()=>()=>{d.forEach(e=>URL.revokeObjectURL(e))},[]),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)(i.PY1.div,{className:"\n          relative border-2 border-dashed rounded-xl p-6 transition-all duration-300 cursor-pointer\n          ".concat(g?"border-sage bg-sage/10 scale-105":"border-sage/30 hover:border-sage/50","\n          ").concat(o?"opacity-50 cursor-not-allowed":"","\n          ").concat(l.length>=t?"opacity-50 cursor-not-allowed":"","\n        "),onDragEnter:w,onDragLeave:w,onDragOver:w,onDrop:j,onClick:l.length<t?I:void 0,whileHover:!o&&l.length<t?{scale:1.02}:{},whileTap:!o&&l.length<t?{scale:.98}:{},children:[(0,r.jsx)("input",{ref:x,type:"file",multiple:!0,accept:"image/*",onChange:E,className:"hidden",disabled:o||l.length>=t}),(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)(i.PY1.div,{animate:{rotate:g?[0,-10,10,0]:0,scale:g?1.1:1},transition:{duration:.3},className:"w-12 h-12 mx-auto mb-4 bg-gradient-to-br from-sage/20 to-sage/10 rounded-full flex items-center justify-center",children:(0,r.jsx)("ion-icon",{name:g?"cloud-upload":"camera",style:{fontSize:"24px",color:"var(--sage)"}})}),l.length>=t?(0,r.jsxs)("p",{className:"font-urbanist text-sm font-500 text-charcoal/60",children:["Maximum ",t," images reached"]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("p",{className:"font-urbanist text-base font-600 text-charcoal mb-2",children:g?"Drop images here":"Add photos to your review"}),(0,r.jsxs)("p",{className:"font-urbanist text-sm font-400 text-charcoal/60",children:["Drag & drop or click to select images",(0,r.jsx)("br",{}),(0,r.jsxs)("span",{className:"text-xs",children:[l.length,"/",t," • JPEG, PNG, WebP • Max 5MB each"]})]})]})]}),(0,r.jsx)(i.Nyo,{children:g&&(0,r.jsx)(i.PY1.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute inset-0 bg-sage/5 rounded-xl flex items-center justify-center",children:(0,r.jsx)(i.PY1.div,{animate:{scale:[1,1.2,1]},transition:{duration:1,repeat:1/0},className:"text-sage",children:(0,r.jsx)("ion-icon",{name:"cloud-upload-outline",style:{fontSize:"48px"}})})})})]}),(0,r.jsx)(i.Nyo,{children:p&&(0,r.jsx)(i.PY1.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"bg-red-50 border border-red-200 rounded-lg p-3",children:(0,r.jsxs)("div",{className:"flex items-center space-x-2 text-red-700",children:[(0,r.jsx)("ion-icon",{name:"alert-circle",style:{fontSize:"18px"}}),(0,r.jsx)("span",{className:"font-urbanist text-sm font-500",children:p})]})})}),(0,r.jsx)(i.Nyo,{children:l.length>0&&(0,r.jsxs)(i.PY1.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"space-y-3",children:[(0,r.jsxs)("h4",{className:"font-urbanist text-sm font-600 text-charcoal flex items-center",children:[(0,r.jsx)("ion-icon",{name:"images",style:{fontSize:"16px",marginRight:"6px"}}),"Selected Images (",l.length,")"]}),(0,r.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:l.map((e,a)=>(0,r.jsxs)(i.PY1.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},transition:{duration:.3},className:"relative group",children:[(0,r.jsx)("div",{className:"aspect-square rounded-lg overflow-hidden bg-sage/10",children:(0,r.jsx)(n.default,{src:d[a],alt:"Preview ".concat(a+1),width:200,height:200,className:"w-full h-full object-cover transition-transform duration-300 group-hover:scale-110"})}),(0,r.jsx)(i.PY1.button,{initial:{opacity:0},animate:{opacity:1},whileHover:{scale:1.1},whileTap:{scale:.9},onClick:e=>{e.stopPropagation(),y(a)},className:"absolute -top-2 -right-2 w-6 h-6 bg-red-500 text-white rounded-full flex items-center justify-center shadow-lg hover:bg-red-600 transition-colors duration-200",disabled:o,children:(0,r.jsx)("ion-icon",{name:"close",style:{fontSize:"14px"}})}),(0,r.jsxs)("div",{className:"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/60 to-transparent p-2",children:[(0,r.jsx)("p",{className:"text-white text-xs font-urbanist font-500 truncate",children:e.name}),(0,r.jsxs)("p",{className:"text-white/70 text-xs font-urbanist",children:[(e.size/1048576).toFixed(1),"MB"]})]})]},"".concat(e.name,"-").concat(a)))})]})})]})}m.ALLOWED_TYPES=["image/jpeg","image/jpg","image/png","image/webp"],m.MAX_FILE_SIZE=5242880,m.MAX_IMAGES_PER_REVIEW=5}}]);